<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Impact & Confidence | ShikshaManthan</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script src="assets/js/data.js"></script>
  <script src="assets/js/progress.js"></script>

  <style>
    body { font-family: 'Poppins', sans-serif; }

    /* Background Pattern */
    .bg-grid-pattern {
        background-image: radial-gradient(#6366f1 0.5px, transparent 0.5px);
        background-size: 24px 24px;
        opacity: 0.1;
    }

    /* Floating Animation */
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
        100% { transform: translateY(0px); }
    }
    .animate-float { animation: float 3s ease-in-out infinite; }

    /* Confetti Animation (CSS Only) */
    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: #f00;
        animation: fall linear forwards;
    }
    @keyframes fall {
        to { transform: translateY(100vh) rotate(720deg); }
    }

    /* Progress Bar Override */
    #progressBar, .progress-bar-fill { background-color: #4f46e5 !important; }
  </style>
</head>

<body class="bg-slate-50 min-h-screen relative text-slate-800 overflow-x-hidden">

<div class="fixed inset-0 bg-grid-pattern pointer-events-none z-0"></div>
<div id="confetti-container" class="fixed inset-0 pointer-events-none z-50"></div>

<div id="header" class="relative z-20 sticky top-0 bg-white/90 backdrop-blur shadow-sm"></div>

<main class="relative z-10 max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-12">

  <section class="text-center space-y-4">
    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-indigo-100 text-indigo-600 text-3xl mb-4 animate-[bounce_1s_infinite]">
        ğŸ†
    </div>
    <h1 class="text-3xl md:text-5xl font-bold text-slate-800 tracking-tight">
      Milestone Unlocked!
    </h1>
    <p class="text-slate-500 max-w-xl mx-auto text-lg">
      Youâ€™ve successfully designed a structured, evidence-based program logic. Here is your impact summary.
    </p>
  </section>

  <section class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <div class="bg-white border border-slate-200 rounded-3xl p-8 shadow-lg hover:shadow-2xl hover:border-indigo-300 transition-all duration-300 group flex flex-col items-center text-center animate-float" style="animation-delay: 0s;">
      <div class="w-14 h-14 bg-blue-50 text-blue-500 rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
        â±ï¸
      </div>
      <p class="text-3xl font-bold text-slate-800 mb-1" id="timeTaken">â€”</p>
      <p class="text-sm font-medium text-slate-400 uppercase tracking-wide">Design Sprint Time</p>
    </div>

    <div class="bg-white border border-slate-200 rounded-3xl p-8 shadow-lg hover:shadow-2xl hover:border-indigo-300 transition-all duration-300 group flex flex-col items-center text-center animate-float" style="animation-delay: 0.5s;">
      <div class="w-14 h-14 bg-green-50 text-green-500 rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
        âœ”ï¸
      </div>
      <p class="text-3xl font-bold text-slate-800 mb-1" id="alignmentScore">â€”</p>
      <p class="text-sm font-medium text-slate-400 uppercase tracking-wide">Logic Alignment</p>
    </div>

    <div class="bg-white border border-slate-200 rounded-3xl p-8 shadow-lg hover:shadow-2xl hover:border-indigo-300 transition-all duration-300 group flex flex-col items-center text-center animate-float" style="animation-delay: 1s;">
      <div class="w-14 h-14 bg-purple-50 text-purple-500 rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
        ğŸ¯
      </div>
      <p class="text-3xl font-bold text-slate-800 mb-1">Done</p>
      <p class="text-sm font-medium text-slate-400 uppercase tracking-wide">Program Status</p>
    </div>

  </section>

  <section class="bg-slate-900 rounded-3xl shadow-xl p-8 md:p-12 text-center relative overflow-hidden">
    <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 bg-indigo-500 rounded-full blur-3xl opacity-20 pointer-events-none"></div>

    <h2 class="text-xl md:text-2xl font-bold text-white mb-3">
      How confident do you feel about this design?
    </h2>
    <p class="text-slate-400 mb-8 max-w-lg mx-auto">
      Your feedback helps the AI refine future suggestions.
    </p>

    <div class="flex flex-wrap justify-center gap-4 md:gap-6">
      <button class="confidence-btn group relative w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-slate-800 border border-slate-700 hover:bg-slate-700 hover:border-indigo-500 transition-all duration-200 shadow-lg" onclick="setConfidence(1)">
        <span class="text-3xl md:text-4xl group-hover:scale-125 block transition-transform">ğŸ˜</span>
      </button>

      <button class="confidence-btn group relative w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-slate-800 border border-slate-700 hover:bg-slate-700 hover:border-indigo-500 transition-all duration-200 shadow-lg" onclick="setConfidence(2)">
        <span class="text-3xl md:text-4xl group-hover:scale-125 block transition-transform">ğŸ™‚</span>
      </button>

      <button class="confidence-btn group relative w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-slate-800 border border-slate-700 hover:bg-slate-700 hover:border-indigo-500 transition-all duration-200 shadow-lg" onclick="setConfidence(3)">
        <span class="text-3xl md:text-4xl group-hover:scale-125 block transition-transform">ğŸ˜€</span>
      </button>

      <button class="confidence-btn group relative w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-slate-800 border border-slate-700 hover:bg-slate-700 hover:border-indigo-500 transition-all duration-200 shadow-lg" onclick="setConfidence(4)">
        <span class="text-3xl md:text-4xl group-hover:scale-125 block transition-transform">ğŸš€</span>
      </button>
    </div>

    <p id="confidenceText" class="mt-6 text-sm font-semibold text-indigo-400 hidden animate-[fade-in_0.5s]">
      Thank you! Your confidence score has been recorded.
    </p>

  </section>

  <section class="flex flex-col-reverse sm:flex-row justify-between items-center gap-6 pt-6 border-t border-slate-200">

    <button onclick="restartFlow()"
      class="w-full sm:w-auto px-6 py-3 rounded-full border border-slate-300 text-slate-600 hover:bg-slate-100 hover:text-slate-900 font-medium transition-colors flex items-center justify-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
      Start New LFA
    </button>

    <button onclick="goDashboard()"
      class="w-full sm:w-auto px-10 py-4 rounded-full bg-gradient-to-r from-indigo-600 to-violet-600 text-white font-bold shadow-lg shadow-indigo-500/30 hover:shadow-indigo-500/50 hover:-translate-y-1 transition-all flex items-center justify-center gap-2">
      Go to Dashboard â†’
    </button>

  </section>

</main>

<script>
// 1. INIT
fetch("components/header.html")
  .then(r => r.text())
  .then(h => {
    // Theme Fix
    document.getElementById("header").innerHTML = h.replace(/teal/g, "indigo");
    loadData();
    if(typeof setProgress === 'function') setProgress(100);
    populateMetrics();
    triggerConfetti(); // Celebration!
  });

/* ================= METRICS ================= */

function populateMetrics() {
  const start = lfaData._startTime || Date.now();
  const end = Date.now();
  // Ensure meaningful time (at least 5 mins for demo)
  const minutes = Math.max(1, Math.round((end - start) / 60000));

  // Animate Count Up
  animateValue("timeTaken", 0, minutes, 1000, " min");
  
  const score = calculateAlignment();
  animateValue("alignmentScore", 0, score, 1500, "%");
}

function animateValue(id, start, end, duration, suffix) {
    let obj = document.getElementById(id);
    let range = end - start;
    let minTimer = 50;
    let stepTime = Math.abs(Math.floor(duration / range));
    stepTime = Math.max(stepTime, minTimer);
    let startTime = new Date().getTime();
    let endTime = startTime + duration;
    let timer;

    function run() {
        let now = new Date().getTime();
        let remaining = Math.max((endTime - now) / duration, 0);
        let value = Math.round(end - (remaining * range));
        obj.innerHTML = value + suffix;
        if (value == end) {
            clearInterval(timer);
        }
    }
    timer = setInterval(run, stepTime);
    run();
}

function calculateAlignment() {
  let score = 0;
  if (lfaData.problem) score += 15;
  if (lfaData.studentOutcome) score += 15;
  if (lfaData.successDefinition) score += 15;
  if (lfaData.stakeholders?.length >= 2) score += 15;
  if (Object.keys(lfaData.practiceChanges || {}).length > 0) score += 15;
  if (lfaData.indicators?.length > 0) score += 25;
  
  if(score > 100) score = 100;
  return score;
}

/* ================= CONFIDENCE ================= */

function setConfidence(level) {
  lfaData.confidence = level;
  saveData();

  // Visual Feedback
  document.getElementById("confidenceText").classList.remove("hidden");
  
  // Highlight selected button logic could go here
  const btns = document.querySelectorAll('.confidence-btn');
  btns.forEach((btn, index) => {
      if(index + 1 === level) {
          btn.classList.add('ring-4', 'ring-indigo-500', 'bg-slate-700');
      } else {
          btn.classList.remove('ring-4', 'ring-indigo-500', 'bg-slate-700');
          btn.classList.add('opacity-50');
      }
  });
}

/* ================= CONFETTI ================= */
function triggerConfetti() {
    const container = document.getElementById('confetti-container');
    const colors = ['#6366f1', '#a855f7', '#ec4899', '#14b8a6', '#f59e0b'];
    
    for (let i = 0; i < 50; i++) {
        const div = document.createElement('div');
        div.classList.add('confetti');
        div.style.left = Math.random() * 100 + 'vw';
        div.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        div.style.animationDuration = (Math.random() * 2 + 2) + 's';
        div.style.animationDelay = (Math.random() * 2) + 's';
        container.appendChild(div);
    }
}

/* ================= NAV ================= */

function restartFlow() {
  localStorage.removeItem("lfaData");
  window.location.href = "setup.html";
}

function goDashboard() {
  window.location.href = "dashboard.html";
}
</script>

</body>
</html>
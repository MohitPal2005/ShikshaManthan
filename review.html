<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Review Program Logic | ShikshaManthan</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script src="assets/js/data.js"></script>
  <script src="assets/js/progress.js"></script>

  <style>
    body { font-family: 'Poppins', sans-serif; }

    /* Background Pattern */
    .bg-grid-pattern {
        background-image: radial-gradient(#6366f1 0.5px, transparent 0.5px);
        background-size: 24px 24px;
        opacity: 0.1;
    }

    /* Logic Flow Connector Lines */
    .connector-line {
        position: absolute;
        background-color: #cbd5e1;
        z-index: 0;
    }
    
    /* Desktop Horizontal Line */
    @media (min-width: 1024px) {
        .connector-line {
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            transform: translateY(-50%);
        }
    }
    
    /* Mobile Vertical Line */
    @media (max-width: 1023px) {
        .connector-line {
            top: 0;
            left: 50%;
            width: 2px;
            height: 100%;
            transform: translateX(-50%);
        }
    }

    /* Card Animations */
    @keyframes fade-in-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-card { animation: fade-in-up 0.5s ease-out forwards; }
    
    /* Progress Bar Override */
    #progressBar, .progress-bar-fill { background-color: #4f46e5 !important; }
  </style>
</head>

<body class="bg-slate-50 min-h-screen relative text-slate-800">

<div class="fixed inset-0 bg-grid-pattern pointer-events-none z-0"></div>

<div id="header" class="relative z-20 sticky top-0 bg-white/90 backdrop-blur shadow-sm"></div>

<main class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 mb-20 space-y-10">

  <section class="text-center space-y-3 animate-card">
    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-green-100 text-green-700 text-xs font-bold uppercase tracking-wide border border-green-200">
        üéâ Framework Complete
    </div>
    <h1 class="text-3xl md:text-4xl font-bold text-slate-800">
      Your Program Logic Blueprint
    </h1>
    <p class="text-slate-500 max-w-2xl mx-auto">
      Review how your problem, interventions, and outcomes connect before exporting your final Logical Framework Analysis (LFA).
    </p>
  </section>

  <section class="relative">
    
    <div class="absolute inset-0 mx-4 lg:mx-0 py-10 lg:py-0 lg:px-10 pointer-events-none">
        <div class="connector-line"></div>
    </div>

    <div class="relative z-10 grid grid-cols-1 lg:grid-cols-4 gap-6 items-stretch">

        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-lg relative group hover:-translate-y-1 transition-transform duration-300 animate-card h-full min-w-0 flex flex-col" style="animation-delay: 0.1s;">
            <div class="w-10 h-10 bg-red-100 text-red-600 rounded-full flex items-center justify-center font-bold mb-4 shadow-sm border border-red-200 text-lg flex-shrink-0">1</div>
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex-shrink-0">The Problem of Teacher</h3>
            
            <div class="flex-grow overflow-hidden">
               <div id="revProblem" class="space-y-4 text-sm text-slate-800">
                    <p id="revProblemText" class="font-medium leading-relaxed whitespace-pre-wrap">
                        Loading...
                    </p>

                    <div id="revProblemDetails" class="hidden">
                        <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wide">
                            Clarifying Insights (Level 1)
                        </h4>
                        <ul id="revProblemQA" class="space-y-2 text-xs text-slate-700"></ul>
                    </div>
                </div>

            </div>
        </div>

        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-lg relative group hover:-translate-y-1 transition-transform duration-300 animate-card h-full min-w-0 flex flex-col" style="animation-delay: 0.2s;">
            <div class="w-10 h-10 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center font-bold mb-4 shadow-sm border border-indigo-200 text-lg flex-shrink-0">2</div>
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex-shrink-0">Required Actions of Stakeholders</h3>
            
            <div class="space-y-3 flex-grow overflow-hidden">
                <div>
                    <span class="text-xs text-indigo-500 font-semibold">Stakeholders:</span>
                    <ul id="revStakeholders" class="text-sm text-slate-700 list-disc list-inside mt-1 marker:text-indigo-300 break-words"></ul>
                </div>
                <div class="pt-2 border-t border-slate-100">
                    <span class="text-xs text-indigo-500 font-semibold">New Practices:</span>
                    <ul id="revPractices" class="text-xs text-slate-600 list-disc list-inside mt-1 marker:text-indigo-300 break-words"></ul>
                </div>
            </div>
        </div>

        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-lg relative group hover:-translate-y-1 transition-transform duration-300 animate-card h-full min-w-0 flex flex-col" style="animation-delay: 0.3s;">
            <div class="w-10 h-10 bg-violet-100 text-violet-600 rounded-full flex items-center justify-center font-bold mb-4 shadow-sm border border-violet-200 text-lg flex-shrink-0">3</div>
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex-shrink-0">Expected Outcomes if Problem solved</h3>
            
            <div class="flex-grow overflow-hidden flex flex-col">
                <p id="revOutcome" class="text-sm font-medium text-slate-800 leading-relaxed mb-3 break-words whitespace-pre-wrap">
                    Loading...
                </p>
                <div class="bg-violet-50 p-2 rounded text-xs text-violet-700 border border-violet-100 italic mt-auto break-words">
                    "<span id="revSuccess"></span>"
                </div>
            </div>
        </div>

        <div class="bg-white border border-slate-200 rounded-2xl p-6 shadow-lg relative group hover:-translate-y-1 transition-transform duration-300 animate-card h-full min-w-0 flex flex-col" style="animation-delay: 0.4s;">
            <div class="w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center font-bold mb-4 shadow-sm border border-green-200 text-lg flex-shrink-0">4</div>
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 flex-shrink-0">Evidence & Indicators for Success</h3>
            
            <div class="flex-grow overflow-hidden">
                <ul id="revIndicators" class="text-sm text-slate-700 space-y-2 break-words"></ul>
            </div>
        </div>

    </div>
  </section>

  <section class="grid grid-cols-1 md:grid-cols-3 gap-8 animate-card" style="animation-delay: 0.5s;">
    
    <div class="md:col-span-1 bg-slate-900 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden flex flex-col justify-center h-full">
        <div class="absolute top-0 right-0 -mr-8 -mt-8 w-32 h-32 bg-indigo-500 rounded-full blur-3xl opacity-20"></div>
        
        <h2 class="text-lg font-bold text-indigo-200 mb-1">System Alignment</h2>
        <p class="text-xs text-slate-400 mb-6">Based on logical flow coherence</p>
        
        <div class="relative w-full aspect-square max-w-[150px] mx-auto mb-4 flex items-center justify-center">
            <div class="w-full h-full rounded-full border-8 border-slate-700 relative"></div>
            <div class="absolute inset-0 rounded-full border-8 border-indigo-500 border-t-transparent border-l-transparent -rotate-45"></div>
            <div class="absolute text-4xl font-bold text-white" id="alignmentText">0%</div>
        </div>
        
        <div class="text-center">
            <span id="alignmentLabel" class="px-3 py-1 rounded-full bg-indigo-600 text-xs font-bold uppercase tracking-wide">Calculating...</span>
        </div>
        
        <div id="alignmentBar" class="hidden"></div> 
    </div>

    <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4">
        
        <div class="bg-white border border-green-200 rounded-xl p-5 shadow-sm h-full flex flex-col">
            <div class="flex items-center gap-2 mb-3 text-green-700 font-bold flex-shrink-0">
                <span class="text-xl">üõ°Ô∏è</span> Strengths
            </div>
            <ul id="aiStrengths" class="text-xs text-slate-600 space-y-2 break-words flex-grow"></ul>
        </div>

        <div class="bg-white border border-red-200 rounded-xl p-5 shadow-sm h-full flex flex-col">
            <div class="flex items-center gap-2 mb-3 text-red-600 font-bold flex-shrink-0">
                <span class="text-xl">‚ö†Ô∏è</span> Attention
            </div>
            <ul id="aiGaps" class="text-xs text-slate-600 space-y-2 break-words flex-grow"></ul>
        </div>

        <div class="bg-white border border-yellow-200 rounded-xl p-5 shadow-sm h-full flex flex-col">
            <div class="flex items-center gap-2 mb-3 text-yellow-700 font-bold flex-shrink-0">
                <span class="text-xl">üí°</span> Suggestions
            </div>
            <ul id="aiSuggestions" class="text-xs text-slate-600 space-y-2 break-words flex-grow"></ul>
        </div>

        <!-- ‚úÖ NEW BLOCK: Overall Verdict -->
        <div class="bg-white border border-indigo-200 rounded-xl p-5 shadow-sm h-full flex flex-col">
            <div class="flex items-center gap-2 mb-3 text-indigo-700 font-bold flex-shrink-0">
                <span class="text-xl">üìå</span> Overall Verdict
            </div>
            <ul id="aiVerdict" class="text-xs text-slate-600 space-y-2 break-words flex-grow"></ul>
        </div>

    </div>

  </section>

  <section class="flex justify-between items-center pt-6 border-t border-slate-200 animate-card" style="animation-delay: 0.6s;">
    <button onclick="goBack()"
      class="flex items-center gap-2 px-6 py-3 rounded-full border border-slate-300 text-slate-600 hover:bg-slate-100 font-medium transition-colors">
      ‚Üê Make Edits
    </button>

    <button onclick="exportAndProceed()"
    class="group relative px-8 py-4 rounded-full bg-indigo-600 text-white font-bold">
    Export & Share LFA ‚Üí
    </button>

  </section>


</main>

<script>
// 1. INIT
fetch("components/header.html")
  .then(r => r.text())
  .then(h => {
    document.getElementById("header").innerHTML = h.replace(/teal/g, "indigo");
    loadData();
    if(typeof setProgress === 'function') setProgress(100);
    populateReview();
  });

// 2. POPULATE DATA
function populateReview() {
  // --- PROBLEM (LEVEL 1) ---
  const problemTextEl = document.getElementById("revProblemText");
  const detailsBox = document.getElementById("revProblemDetails");
  const qaList = document.getElementById("revProblemQA");

  if (problemTextEl) {
    problemTextEl.innerText = lfaData.problem || "Not defined";
  }

  if (
    detailsBox &&
    qaList &&
    Array.isArray(lfaData.followUpAnswers) &&
    lfaData.followUpAnswers.length > 0
  ) {
    detailsBox.classList.remove("hidden");
    qaList.innerHTML = "";

    lfaData.followUpAnswers.forEach((item, index) => {
      const li = document.createElement("li");
      li.className = "bg-slate-50 border border-slate-200 rounded-lg p-2";

      li.innerHTML = `
        <p class="font-semibold text-slate-600">
          Q${index + 1}. ${item.question}
        </p>
        <p class="text-slate-700 mt-1">‚Üí ${item.answer}</p>
      `;

      qaList.appendChild(li);
    });
  } else if (detailsBox) {
    detailsBox.classList.add("hidden");
  }

  // --- OTHER FIELDS ---
  document.getElementById("revOutcome").innerText =
    lfaData.studentOutcome || "Not defined";

  document.getElementById("revSuccess").innerText =
    lfaData.successDefinition || "Not defined";

  fillList("revStakeholders", lfaData.stakeholders);
  fillList("revPractices", Object.values(lfaData.practiceChanges || {}));
  fillList(
    "revIndicators",
    (lfaData.indicators || []).map(i => `‚úÖ ${i.text}`)
  );

  calculateLevel1Alignment();
  generateAISummary();
}

function fillList(id, items) {
  const ul = document.getElementById(id);
  ul.innerHTML = "";
  if(!items || items.length === 0) {
      ul.innerHTML = "<li class='text-slate-400 italic'>None recorded</li>";
      return;
  }
  items.forEach(i => {
    const li = document.createElement("li");
    // Simple logic to keep emoji if present
    li.innerText = i.startsWith("‚úÖ") ? i : i.replace("‚úÖ ", ""); 
    ul.appendChild(li);
  });
}

// 3. LOGIC ANALYTICS
// function calculateAlignment() {
//   let score = 0;
//   if (lfaData.problem && lfaData.problem.length > 20) score += 15;
//   if (lfaData.studentOutcome && lfaData.studentOutcome.length > 20) score += 15;
//   if (lfaData.successDefinition) score += 15;
//   if (lfaData.stakeholders && lfaData.stakeholders.length >= 2) score += 15;
//   if (lfaData.practiceChanges && Object.keys(lfaData.practiceChanges).length > 0) score += 15;
//   if (lfaData.indicators && lfaData.indicators.length > 0) score += 25;

//   // Cap at 100
//   if(score > 100) score = 100;

//   // Update Visuals
//   document.getElementById("alignmentText").innerText = score + "%";
  
//   // Label Logic
//   const label = document.getElementById("alignmentLabel");
//   if(score >= 80) {
//       label.innerText = "Excellent Alignment";
//       label.className = "px-3 py-1 rounded-full bg-green-500 text-white text-xs font-bold uppercase tracking-wide";
//   } else if (score >= 50) {
//       label.innerText = "Good Start";
//       label.className = "px-3 py-1 rounded-full bg-yellow-500 text-white text-xs font-bold uppercase tracking-wide";
//   } else {
//       label.innerText = "Needs Refinement";
//       label.className = "px-3 py-1 rounded-full bg-red-500 text-white text-xs font-bold uppercase tracking-wide";
//   }
// }
/**
 * TASK: Fetch Level 1 Score and Update System Alignment UI
 */


// Helper to update the Visual Gauge
function updateAlignmentUI(score) {
    // Clamp score 0-100
    if (score > 100) score = 100;
    if (score < 0) score = 0;

    // Update Number
    document.getElementById("alignmentText").innerText = score + "%";

    // Update Circle Rotation (360deg = 100%)
    // The gauge logic in your CSS relies on a rotated border. 
    // This targets the div with the indigo border.
    const gaugeCircle = document.querySelector("#alignmentText").previousElementSibling;
    if (gaugeCircle) {
        const degrees = (score / 100) * 360;
        gaugeCircle.style.transform = `rotate(${degrees}deg)`;
        
        // Dynamic Color: Red (<50), Yellow (50-79), Green (80+)
        let colorClass = "border-red-500";
        let labelText = "Needs Focus";
        let labelColor = "bg-red-500";

        if (score >= 80) {
            colorClass = "border-green-500";
            labelText = "High Alignment";
            labelColor = "bg-green-500";
        } else if (score >= 50) {
            colorClass = "border-yellow-500";
            labelText = "Moderate";
            labelColor = "bg-yellow-500";
        }

        // Reset and add new color class
        gaugeCircle.className = `absolute inset-0 rounded-full border-8 ${colorClass} border-t-transparent border-l-transparent transition-all duration-1000`;
        
        // Update Label
        const labelEl = document.getElementById("alignmentLabel");
        labelEl.innerText = labelText;
        labelEl.className = `px-3 py-1 rounded-full ${labelColor} text-white text-xs font-bold uppercase tracking-wide`;
    }
}

// 4. AI GENERATION
// CONFIG: Define your backend URL
const BACKEND_URL = "https://shivam-99x-level1-undestandingscore.hf.space";

/**
 * TASK 1: Extract Problem & QA and send to Backend
 * Replaces the old local generateAISummary()
 */
async function generateAISummary() {
    // 1. Extract Data from DOM
    const problemText = document.getElementById("revProblemText").innerText;
    const qaContainer = document.getElementById("revProblemQA");
    const qaText = qaContainer ? qaContainer.innerText : ""; // extracted text from Q&A list

    // 2. Prepare Context String
    const contextData = `
    [PROBLEM START]
    ${problemText}
    [PROBLEM END]

    [CLARIFICATIONS START]
    ${qaText}
    [CLARIFICATIONS END]
    `;

    // 3. UI Loading State (Optional but recommended)
    document.getElementById("aiStrengths").innerHTML = "<li class='animate-pulse'>Analyzing...</li>";
    document.getElementById("aiGaps").innerHTML = "<li class='animate-pulse'>Scanning...</li>";
    document.getElementById("aiSuggestions").innerHTML = "<li class='animate-pulse'>Thinking...</li>";

    try {
        // 4. Send to Backend
        const response = await fetch(`${BACKEND_URL}/review-level2`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                analysis_context: contextData,
                // We ask the AI to strictly format the output for Task 2
                user_feedback: "Analyze this logic. Output strictly 3 sections. Use EXACTLY these headers: [STRENGTHS], [ATTENTION], [SUGGESTIONS]. Do not add words to the headers. Use bullet points."
            })
        });

        const data = await response.json();
        
        // Trigger Task 2
        if (data && data.result) {
            parseAndInjectAIResponse(data.result);
        }

    } catch (error) {
        console.error("AI Fetch Error:", error);
        document.getElementById("aiStrengths").innerHTML = "<li class='text-red-500'>Connection failed.</li>";
    }
}

/**
 * TASK 2: Split Response & Inject into Columns
 */
 function parseAndInjectAIResponse(textBlock) {
    const fillColumn = (elementId, content) => {
        const ul = document.getElementById(elementId);
        ul.innerHTML = ""; 
        if (!content) return;
        const lines = content.split('\n')
            .map(line => line.replace(/^[-*‚Ä¢]\s*/, '').trim())
            .filter(line => line.length > 0);
        lines.forEach(line => {
            const li = document.createElement("li");
            li.className = "flex gap-2 items-start";
            li.innerHTML = `<span>${line}</span>`;
            ul.appendChild(li);
        });
    };

    let strengths = "";
    let attention = "";
    let suggestions = "";

    // FIXED REGEX: matches [ATTENTION...] instead of strictly [ATTENTION]
    if (textBlock.match(/\[(STRENGTHS|ATTENTION|SUGGESTIONS)/)) {
        const parts = textBlock.split(/\[(STRENGTHS|ATTENTION|SUGGESTIONS).*?\]/);
        
        for (let i = 1; i < parts.length; i += 2) {
            const header = parts[i];   // This will be just "ATTENTION" (or STRENGTHS/SUGGESTIONS)
            const content = parts[i + 1];

            if (header === "STRENGTHS") strengths += content; // += handles if AI splits attention into multiple blocks
            else if (header === "ATTENTION") attention += content;
            else if (header === "SUGGESTIONS") suggestions += content;
        }
    } else {
        suggestions = textBlock;
    }

    fillColumn("aiStrengths", strengths);
    fillColumn("aiGaps", attention);
    fillColumn("aiSuggestions", suggestions);
}

// 5. NAV
function goBack() {
  window.location.href = "level7.html";
}

function goNext() {
  // Normally leads to Export page
  window.location.href = "export.html"; 
  // alert("Ready for Export!");
}

function downloadReviewText() {
  generateAndStoreReviewPDF(true);
}

function exportAndProceed() {
  // 1Ô∏è‚É£ PDF generate + store (NO download)
  generateAndStoreReviewPDF(false);

  // 2Ô∏è‚É£ Next page
  window.location.href = "export.html";
}


// ... all your other functions (goBack, goNext, downloadReviewText, etc.) ...

// --- PASTE THESE TWO FUNCTIONS HERE AT THE BOTTOM ---

async function calculateLevel1Alignment() {
    // 1. Extract Data
    const problemText = document.getElementById("revProblemText").innerText;
    
    // Extract Q&A pairs
    const qaPairs = [];
    document.querySelectorAll('#revProblemQA li').forEach(li => {
        const text = li.innerText; 
        const parts = text.split('‚Üí'); 
        if (parts.length >= 2) {
            qaPairs.push({
                question: parts[0].replace(/Q\d+\./, '').trim(),
                answer: parts[1].trim()
            });
        }
    });

    // 2. Loading State
    document.getElementById("alignmentText").innerText = "...";
    document.getElementById("alignmentLabel").innerText = "Analyzing...";

    try {
        // 3. Send to Backend
        const response = await fetch(`${BACKEND_URL}/submit-level1`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                problem: problemText,
                followUpAnswers: qaPairs
            })
        });

        const data = await response.json();
        
        // 4. Extract Score
        let score = 0;
        if (data && data.analysis) {
            const match = data.analysis.match(/(\d{1,3})%/);
            if (match) score = parseInt(match[1]);
        }

        // 5. Update UI
        updateAlignmentUI(score);

    } catch (error) {
        console.error("Level 1 API Error:", error);
        document.getElementById("alignmentLabel").innerText = "Error";
    }
}

function updateAlignmentUI(score) {
    if (score > 100) score = 100;
    if (score < 0) score = 0;

    document.getElementById("alignmentText").innerText = score + "%";

    const gaugeCircle = document.querySelector("#alignmentText").previousElementSibling;
    if (gaugeCircle) {
        const degrees = (score / 100) * 360;
        gaugeCircle.style.transform = `rotate(${degrees}deg)`;
        
        let colorClass = "border-red-500";
        let labelText = "Needs Focus";
        let labelColor = "bg-red-500";

        if (score >= 80) {
            colorClass = "border-green-500";
            labelText = "High Alignment";
            labelColor = "bg-green-500";
        } else if (score >= 50) {
            colorClass = "border-yellow-500";
            labelText = "Moderate";
            labelColor = "bg-yellow-500";
        }

        gaugeCircle.className = `absolute inset-0 rounded-full border-8 ${colorClass} border-t-transparent border-l-transparent transition-all duration-1000`;
        
        const labelEl = document.getElementById("alignmentLabel");
        labelEl.innerText = labelText;
        labelEl.className = `px-3 py-1 rounded-full ${labelColor} text-white text-xs font-bold uppercase tracking-wide`;
    }
}
function generateAndStoreReviewPDF(autoDownload = false) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });

  doc.setFont("Helvetica");

  let y = 40;
  const lineHeight = 16;
  const pageHeight = doc.internal.pageSize.height - 40;

  function addText(text, isTitle = false) {
    if (y > pageHeight) {
      doc.addPage();
      y = 40;
    }
    doc.setFont(undefined, isTitle ? "bold" : "normal");
    doc.setFontSize(isTitle ? 14 : 11);
    const lines = doc.splitTextToSize(text, 520);
    doc.text(lines, 40, y);
    y += lines.length * lineHeight + 6;
  }

  // ===== SAME CONTENT AS EXISTING PDF =====
  addText("PROGRAM LOGIC REVIEW", true);
  addText(" ");

  addText("1. PROBLEM STATEMENT", true);
  addText(lfaData.problem || "Not defined");

  if (Array.isArray(lfaData.followUpAnswers) && lfaData.followUpAnswers.length > 0) {
    addText("Clarifying Insights:", true);
    lfaData.followUpAnswers.forEach((item, index) => {
      addText(`Q${index + 1}: ${item.question}`);
      addText(`Answer: ${item.answer}`);
    });
  }

  addText("2. Required Actions of Stakeholders", true);
  (lfaData.stakeholders || []).forEach(s => addText(`- ${s}`));

  addText("New Practices:");
  Object.values(lfaData.practiceChanges || {}).forEach(p => addText(`- ${p}`));

  addText("3. Expected Outcomes if Problem solved", true);
  addText(lfaData.studentOutcome || "Not defined");

  addText("Success Definition:");
  addText(lfaData.successDefinition || "Not defined");

  addText("4. Evidence & Indicators for Success", true);
  (lfaData.indicators || []).forEach(i => addText(`- ${i.text}`));

  // AI SUMMARY (DOM based ‚Äì review.html has it)
  addText("AI REVIEW SUMMARY", true);

// Strengths
addText("Strengths", true);
document.querySelectorAll("#aiStrengths li").forEach(li =>
  addText(`- ${li.innerText}`)
);

// Attention
addText("Attention", true);
document.querySelectorAll("#aiGaps li").forEach(li =>
  addText(`- ${li.innerText}`)
);

// Suggestions
addText("Suggestions", true);
document.querySelectorAll("#aiSuggestions li").forEach(li =>
  addText(`- ${li.innerText}`)
);

// Overall Verdict
addText("Overall Verdict", true);
document.querySelectorAll("#aiVerdict li").forEach(li =>
  addText(`- ${li.innerText}`)
);


  // Alignment
  const alignmentScore = document.getElementById("alignmentText")?.innerText || "N/A";
  const alignmentLabel = document.getElementById("alignmentLabel")?.innerText || "N/A";
  addText(`Score: ${alignmentScore}`);
  addText(`Status: ${alignmentLabel}`);

  // ===== STORE PDF =====
  const pdfBase64 = doc.output("datauristring");
sessionStorage.setItem("reviewPDF", pdfBase64);
}


// END OF SCRIPT
</script>

</body>
</html>

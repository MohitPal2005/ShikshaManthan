<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Export LFA | ShikshaManthan</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script src="assets/js/data.js"></script>
  <script src="assets/js/progress.js"></script>

  <style>
    body { font-family: 'Poppins', sans-serif; }

    /* Background Pattern */
    .bg-grid-pattern {
        background-image: radial-gradient(#6366f1 0.5px, transparent 0.5px);
        background-size: 24px 24px;
        opacity: 0.1;
    }

    /* ===== FLOATING ANIMATION (Impact Page) ===== */
@keyframes float {
  0%   { transform: translateY(0px); }
  50%  { transform: translateY(-6px); }
  100% { transform: translateY(0px); }
}

.animate-float {
  animation: float 3s ease-in-out infinite;
}

/* ===== CONFETTI (OPTIONAL CELEBRATION) ===== */
.confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  animation: fall linear forwards;
  pointer-events: none;
}

@keyframes fall {
  to {
    transform: translateY(100vh) rotate(720deg);
  }
}


    /* Card Animations */
    @keyframes fade-in-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-card {
  animation: fade-in-up 0.5s ease-out;
}

    /* Button Glow */
    .btn-glow:hover {
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
    }
    
    /* Progress Bar Override */
    #progressBar, .progress-bar-fill { background-color: #4f46e5 !important; }
  </style>
</head>

<body class="bg-slate-50 min-h-screen relative text-slate-800">

  <div id="confetti-container" class="fixed inset-0 pointer-events-none z-50"></div>

<div class="fixed inset-0 bg-grid-pattern pointer-events-none z-0"></div>
<div id="header" class="relative z-20 sticky top-0 bg-white/90 backdrop-blur shadow-sm"></div>

<main class="relative z-10 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-10">

  <section class="text-center space-y-4 animate-card">
    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-indigo-100 text-indigo-700 text-xs font-bold uppercase tracking-wide border border-indigo-200">
        üöÄ Ready for Launch
    </div>
    <h1 class="text-3xl md:text-5xl font-bold text-slate-800 tracking-tight">
      Export Your Program Logic
    </h1>
    <p class="text-slate-500 max-w-2xl mx-auto text-lg">
      Your framework is complete. Share this LFA with partners, funders, or your team to begin implementation.
    </p>
  </section>

  <section class="flex justify-center">

    <div class="bg-white border border-slate-200 rounded-3xl p-8 animate-card animate-float">
      <div class="w-16 h-16 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform shadow-sm">
        üìÑ
      </div>
      <h3 class="text-xl font-bold text-slate-800 mb-2">Download PDF</h3>
      <p class="text-sm text-slate-500 mb-6 flex-grow">
        Best for sharing a locked, professional version with external funders.
      </p>
      <button onclick="downloadReviewText()"
          class="px-6 py-3 rounded-full bg-slate-800 text-white font-bold shadow hover:bg-slate-900 transition">
          Download Review (as pdf)
      </button>
    </div>

  </section>

  <section class="bg-white rounded-3xl shadow-xl border border-slate-200 p-8 animate-card animate-float">
    <div class="flex items-start gap-4">
        <div class="text-3xl pt-1">üí¨</div>
        <div class="w-full">
            <h2 class="text-lg font-bold text-slate-800 mb-1">
                Executive Notes
            </h2>
            <p class="text-sm text-slate-400 mb-4">
                Add context, version history, or specific questions for your reviewers.
            </p>
            <textarea
                rows="4"
                placeholder="e.g., 'This is Draft V2 based on the donor feedback regarding the budget...'"
                class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all resize-none text-slate-700"
                oninput="saveComment(this.value)"
            ></textarea>
        </div>
    </div>
  </section>

  <section class="flex justify-between items-center pt-6 animate-card" style="animation-delay: 0.5s;">
    <button onclick="goBack()"
      class="flex items-center gap-2 px-6 py-3 rounded-full border border-slate-300 text-slate-600 hover:bg-slate-100 font-medium transition-colors">
      ‚Üê Back to Review
    </button>

    <button
  onclick="goDashboard()"
  class="px-10 py-4 rounded-full bg-gradient-to-r from-indigo-600 to-violet-600 text-white font-bold shadow-lg shadow-indigo-500/30 hover:shadow-indigo-500/50 hover:-translate-y-1 transition-all">
  Go to Dashboard ‚Üí
</button>
  </section>

</main>

<script>
// 1. INIT
fetch("components/header.html")
  .then(r => r.text())
  .then(h => {
    // Theme Fix
    document.getElementById("header").innerHTML = h.replace(/teal/g, "indigo");
    loadData();
    if(typeof setProgress === 'function') setProgress(100);
  });

//   function downloadReviewText() {
//   const { jsPDF } = window.jspdf;
//   const doc = new jsPDF({ unit: "pt", format: "a4" });

//   let y = 40;
//   const lineHeight = 16;
//   const pageHeight = doc.internal.pageSize.height - 40;

//   function addText(text, isTitle = false) {
//     if (y > pageHeight) {
//       doc.addPage();
//       y = 40;
//     }
//     doc.setFont("Helvetica", isTitle ? "bold" : "normal");
//     doc.setFontSize(isTitle ? 14 : 11);

//     const lines = doc.splitTextToSize(text, 520);
//     doc.text(lines, 40, y);
//     y += lines.length * lineHeight + 6;
//   }

//   // ===== CONTENT =====
//   addText("PROGRAM LOGIC REVIEW", true);
//   addText(" ");

//   addText("1. PROBLEM STATEMENT", true);
//   addText(lfaData.problem || "Not defined");

//   if (Array.isArray(lfaData.followUpAnswers)) {
//     addText("Clarifying Insights:", true);
//     lfaData.followUpAnswers.forEach((item, i) => {
//       addText(`Q${i + 1}: ${item.question}`);
//       addText(`Answer: ${item.answer}`);
//     });
//   }

//   addText("2. Required Actions of Stakeholders", true);
//   (lfaData.stakeholders || []).forEach(s => addText(`- ${s}`));

//   addText("New Practices:");
//   Object.values(lfaData.practiceChanges || {}).forEach(p => addText(`- ${p}`));

//   addText("3. Expected Outcomes", true);
//   addText(lfaData.studentOutcome || "Not defined");

//   addText("Success Definition:");
//   addText(lfaData.successDefinition || "Not defined");

//   addText("4. Indicators", true);
//   (lfaData.indicators || []).forEach(i => addText(`- ${i.text}`));

//   addText("EXPORT NOTES", true);
//   addText(lfaData.exportComment || "‚Äî");

//   doc.save("Program_Logic_Review.pdf");
// }

function downloadReviewText() {
  const pdfData = sessionStorage.getItem("reviewPDF");

  if (!pdfData) {
    alert("Please export from Review page first.");
    return;
  }

  const a = document.createElement("a");
  a.href = pdfData;
  a.download = "Program_Logic_Review.pdf";
  a.click();
}

if (typeof setProgress === "function") setProgress(100);
triggerConfetti();



// 2. EXPORT FUNCTIONS (Mock)
// function downloadPDF() {
//   // Hackathon demo interaction
//   const btn = event.target;
//   const originalText = btn.innerText;
//   btn.innerText = "Generating PDF...";
//   setTimeout(() => {
//       alert("üìÑ PDF Export simulated!\n(Backend integration required for file generation)");
//       btn.innerText = originalText;
//   }, 800);
// }

// function downloadDoc() {
//   const btn = event.target;
//   const originalText = btn.innerText;
//   btn.innerText = "Creating Doc...";
//   setTimeout(() => {
//       alert("üìù Word Doc Export simulated!\n(Backend integration required for file generation)");
//       btn.innerText = originalText;
//   }, 800);
// }

// function generateLink() {
//   const btn = event.target;
//   const originalText = btn.innerText;
//   btn.innerText = "Copied!";
//   navigator.clipboard.writeText("https://shikshamanthan.app/review/share/12345");
//   setTimeout(() => {
//       alert("üîó Review link copied to clipboard:\nhttps://shikshamanthan.app/review/share/12345");
//       btn.innerText = originalText;
//   }, 500);
// }

// 3. LOGIC
function saveComment(text) {
  lfaData.exportComment = text;
  saveData();
}

// 4. NAVIGATION
function goDashboard() {
  // TEMP user session (adjust as needed)
  if (!localStorage.getItem("currentUser")) {
    localStorage.setItem(
      "currentUser",
      JSON.stringify({
        name: "Guest User",
        role: "Viewer",
        organization: "ShikshaManthan",
        region: "India"
      })
    );
  }

  window.location.href = "dashboard.html";
}


function goBack() {
  window.location.href = "review.html";
}

// ===== CONFETTI CELEBRATION (VISUAL ONLY) =====
function triggerConfetti() {
  const container = document.getElementById("confetti-container");
  if (!container) return;

  const colors = ["#6366f1", "#a855f7", "#ec4899", "#14b8a6", "#f59e0b"];

  for (let i = 0; i < 40; i++) {
    const div = document.createElement("div");
    div.className = "confetti";
    div.style.left = Math.random() * 100 + "vw";
    div.style.top = "-10px";
    div.style.backgroundColor =
      colors[Math.floor(Math.random() * colors.length)];
    div.style.animationDuration = Math.random() * 2 + 2 + "s";
    div.style.animationDelay = Math.random() + "s";
    container.appendChild(div);
  }

  // cleanup
  setTimeout(() => (container.innerHTML = ""), 6000);
}

</script>

</body>
</html>
